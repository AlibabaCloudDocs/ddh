# 在DDH上创建ECS实例

当您拥有一台或多台DDH时，您可以在DDH上创建对应规格的ECS实例。

在指定的DDH上创建ECS实例前，您必须先完成以下工作。

-   创建DDH。详细步骤，请参见[创建DDH](/cn.zh-CN/快速入门/创建DDH.md)。
-   完成[实名认证](https://help.aliyun.com/document_detail/37183.html)。
-   如果要创建按量付费ECS实例，账户余额不能少于100元人民币。充值详情，请参见[如何充值付款](https://help.aliyun.com/document_detail/37107.html)。
-   在DDH所在地域里，搭建IPv4专有网络，详情请参见[搭建IPv4专有网络](/cn.zh-CN/快速入门/搭建IPv4专有网络.md)。
-   如果不使用系统自动创建的默认安全组，必须在目标地域创建一个安全组并添加满足您业务需求的安全组规则。具体步骤，请参见[创建安全组](/cn.zh-CN/安全/安全组/创建安全组.md)和[添加安全组规则](/cn.zh-CN/安全/安全组/添加安全组规则.md)。
-   创建Linux实例时如果要绑定SSH密钥对，必须在目标地域创建一个SSH密钥对，详情请参见[创建SSH密钥对](/cn.zh-CN/安全/SSH密钥对/使用SSH密钥对/创建SSH密钥对.md)。
-   如果要设置自定义数据，必须准备实例自定义数据，详情请参见[生成实例自定义数据](/cn.zh-CN/实例/管理实例/使用实例自定义数据/生成实例自定义数据.md)。
-   如果要让实例扮演某个角色，必须创建实例RAM角色并授权，详情请参见[授予实例RAM角色](/cn.zh-CN/安全/实例RAM角色/授予实例RAM角色.md)。

在DDH上只能创建VPC类型ECS实例。DDH上的ECS实例与共享宿主机上ECS实例的功能差异，请参见[ECS实例功能对比](/cn.zh-CN/产品简介/功能特性/ECS实例功能对比.md)。

您可以观看以下视频了解如何在DDH上创建ECS实例，详细设置请参见本文的操作步骤一节。

1.  登录[ECS管理控制台](https://ecs.console.aliyun.com)。

2.  在左侧导航栏，单击**实例与镜像** \> **专有宿主机 DDH**。

3.  在顶部菜单栏左上角处，选择地域。

4.  找到待创建ECS实例的DDH，在**操作**区域，单击**创建实例**。

5.  完成**基础配置**。

    1.  选择**专有宿主机**。

        默认是您选中的DDH。您可以更换专有宿主机。

    2.  设置**关联宿主机**。

        -   选中**关联宿主机**复选框：已停机释放资源的实例再次启动时，依然会部署在当前DDH上。若当前DDH可用资源不足，则实例启动失败。
        -   清除**关联宿主机**复选框：已停机释放资源的实例再次启动时，若当前DDH可用资源不足，则系统自动选择您账号下其他满足自动部署条件的DDH部署实例。更多详情，请参见[关联宿主机功能介绍](/cn.zh-CN/产品简介/功能特性/功能特性.md)。
    3.  选择**付费模式**。

        根据DDH的付费模式选择ECS实例的付费模式。您可以在包年包月DDH上创建**包年包月**或者**按量付费**的ECS实例。

        **说明：** 如果要创建按周付费的ECS实例，必须选择**包年包月**，并将页面底部的**购买周期**设置为**1周**。ECS实例各付费模式的区别，请参见[计费方式概述](/cn.zh-CN/产品定价/计费方式/计费方式概述.md)。

    4.  设置实例规格和实例数量。

        ECS实例的地域及可用区与DDH相同，可供选择的实例规格由DDH的主机规格及剩余资源决定。宿主机规格详情，请参见[宿主机规格](/cn.zh-CN/产品简介/宿主机规格.md)。

        -   如果宿主机仅支持预定义实例规格，在列表中选择实例规格。

            ![系统ECS实例规格](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1088185951/p100859.png)

        -   如果宿主机支持自定义实例规格，单击**自定义实例规格**，并滑动指针调整vCPU和内存的大小。vCPU最小调整单位为1vCPU，1vCPU以上仅支持偶数，例如2vCPU、4vCPU。内存最小调整单位为1GiB。

            ![自定义ECS实例规格](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1088185951/p100857.png)

    5.  选择镜像。

        您可以选择公共镜像、自定义镜像、共享镜像或从镜像市场选择镜像。如何选择镜像，请参见[选择镜像](/cn.zh-CN/镜像/选择镜像.md)。

        **说明：**

        -   如果您要使用SSH密钥对，必须选择Linux系统。
        -   如果您要设置实例自定义数据，只能选择特定的镜像，详情请参见[实例自定义数据支持的镜像](/cn.zh-CN/实例/管理实例/使用实例自定义数据/配置实例自定义数据.md)。
    6.  选择存储。

        -   **系统盘**（必选）：用于安装操作系统。请指定系统盘的云盘类型和容量。
            -   云盘类型：当前地域可供选择的所有云盘类型。
            -   容量：系统盘默认容量为40GiB，最大为500GiB。如果选择的镜像文件大于40GiB，则默认为镜像文件大小。系统盘最低容量与镜像有关，实际情况以购买页显示为准。

                |镜像|系统盘容量范围（GiB）|
                |:-|:-----------|
                |Linux（不包括CoreOS和Red Hat）|\[max\{20, 镜像文件大小\}, 500\]|
                |FreeBSD|\[max\{30, 镜像文件大小\}, 500\]|
                |CoreOS|\[max\{30, 镜像文件大小\}, 500\]|
                |Red Hat|\[max\{40, 镜像文件大小\}, 500\]|
                |Windows|\[max\{40, 镜像文件大小\}, 500\]|

        -   **数据盘**：若添加数据盘，必须选择云盘类型、容量、数量，并选择是否**加密**。您可以创建空云盘，也可以使用快照创建云盘。最多可以添加16块云盘作数据盘。

            **说明：** 此时创建的云盘有以下特点：

            -   付费模式与实例相同。
            -   包年包月数据盘只能随实例一起释放，按量付费的数据盘可以设置为随实例一起释放。
        -   如果您选择的是带本地盘的实例规格族（例如i2），这里会显示实例规格对应的本地盘信息，不可配置。本地盘实例规格对应的本地盘信息，请参见[实例规格族](/cn.zh-CN/实例/实例规格族.md)。
    7.  单击**下一步：网络和安全组**。

6.  完成**网络和安全组**设置。

    1.  选择**网络**。

        只能选择**专有网络**，并选择一个专有网络和交换机。如果您没有创建专有网络和交换机，可以使用默认专有网络和默认交换机。

    2.  设置**公网带宽**。

        -   如果要为实例分配一个公网IP地址，必须选中**分配公网IPv4地址**，再选择**按使用流量**或**按固定带宽**进行公网带宽计费，并指定带宽。通过这种方式分配的公网IP地址不能与实例解绑。关于如何选择公网带宽付费模式，请参见[公网带宽计费](/cn.zh-CN/产品定价/计费项/公网带宽计费.md)。
        -   如果您的实例不需要访问公网或者要使用弹性公网IP（EIP）地址访问公网，不能选择**分配公网IPv4地址**。
    3.  选择**安全组**。

        所选安全组中的规则必须满足您的业务需求。

        **说明：** 如果您自己没有创建安全组，可以使用默认安全组。默认安全组的规则，请参见[默认安全组规则]()。

    4.  添加**弹性网卡**。

        如果所选实例规格支持弹性网卡，您可以添加弹性网卡，并为网卡选择交换机。

        **说明：** 这里添加的弹性网卡默认会随实例一起释放，您可以在ECS控制台或者使用[DetachNetworkInterface](/cn.zh-CN/API参考/弹性网卡/DetachNetworkInterface.md)接口分离实例和网卡。

    5.  单击**下一步：系统配置**。

7.  完成**系统配置**。

    1.  选择并设置**登录凭证**。

        您可以直接设置，也可以选择**创建后设置**。根据镜像的操作系统，选择登录凭证。

        -   Linux系统：可以选择使用密钥对或密码作为登录凭证。
        -   Windows系统：只能使用密码作为登录凭证。
    2.  设置**实例名称**及**主机名**。

    3.  设置**高级选项**。

        -   实例RAM角色：为实例授予一个RAM角色。
        -   实例自定义数据：自定义实例的启动行为或者向实例传入数据。
    4.  单击**下一步：分组设置**。

8.  完成**分组设置**。

    -   如果您有多台实例，为了方便管理，建议您为实例添加标签。
    -   如果您是企业用户，已经开通了资源管理服务，而且已经创建了资源组，您可以按资源组管理实例。
9.  确认订单并创建实例。

    1.  在**所选配置**区域，确认配置信息。

        您可以单击![编辑配置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1088185951/p1347.png)图标重新编辑配置。

    2.  根据ECS实例付费模式设置释放或者续费。

        -   如果ECS实例付费模式为**包年包月**，可以设置购买时长，并选择是否开启**自动续费**。

            **说明：** 包年包月ECS实例的购买时长终点不能晚于包年包月DDH计费时长的终点。

        -   如果ECS实例付费模式为**按量付费**，可以**设置自动释放服务时间**。
    3.  确认**配置费用**。这时显示的费用包括系统盘、数据盘（如果有）和公网带宽的费用。

    4.  阅读并确认**云服务器ECS服务条款**。

    5.  根据ECS实例付费模式确认创建实例。

        -   如果ECS实例付费模式为**包年包月**，单击**确认下单**。
        -   如果ECS实例付费模式为**按量付费**，单击**创建实例**。

实例创建后，单击**管理控制台**回到ECS管理控制台查看新建的ECS实例。在相应地域的**实例列表**中，您能查看新建实例的实例ID、公网IP地址、私有IP地址等信息。如果您已经设置了实例列表的**自定义列表项**，您还可以看到ECS实例的宿主机信息。

**说明：** 设置**自定义列表项**的步骤，请参见[在不同DDH之间迁移ECS实例](/cn.zh-CN/用户指南/迁移ECS实例/在不同DDH之间迁移ECS实例.md)。

-   您可以通过FTP服务上传本地文件到ECS实例。关于部署FTP服务的详细操作，请参见[使用ECS实例创建FTP站点](/cn.zh-CN/建站教程/搭建应用/搭建FTP站点/手动搭建FTP站点（Windows）.md)。
-   创建实例后，建议您对操作系统做安全合规性检查和加固：
    -   Linux实例，请参见[Linux操作系统加固](https://help.aliyun.com/document_detail/49809.html)。
    -   Windows实例，请参见[Windows操作系统安全加固](https://help.aliyun.com/document_detail/49781.html)。
-   如果您随实例创建了数据盘，只有分区格式化后您才能正常使用数据盘，具体操作，请参见[Linux格式化数据盘](/cn.zh-CN/块存储/云盘基础操作/分区格式化数据盘/Linux格式化数据盘.md)或[Windows格式化数据盘](/cn.zh-CN/块存储/云盘基础操作/分区格式化数据盘/Windows格式化数据盘.md)。

**相关文档**  


[RunInstances](/cn.zh-CN/API参考/实例/RunInstances.md)

